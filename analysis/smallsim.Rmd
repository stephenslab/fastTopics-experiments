---
title: Add title here
author: Peter Carbonetto
output: workflowr::wflow_html
---

*Add text here.*

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.align = "center",dpi = 120)
```

Load the packages used in the analysis below, as well as additional
functions that we will use to simulate the data.

```{r load-pkgs, message=FALSE}
library(fastTopics)
library(mvtnorm)
library(ggplot2)
library(cowplot)
source("../code/smallsim_functions.R")
```

Set the seed so that the results can be reproduced.

```{r set-seed}
set.seed(1)
```

Independent topics scenario
---------------------------

*Add text here.*

```{r simulate-data-1}
n <- 100
m <- 400
k <- 6
S <- matrix(-2,k,k) + 13*diag(k)
F <- simulate_factors(m,k)
L <- simulate_loadings(n,k,S)
s <- simulate_sizes(n)
X <- simulate_multinom_counts(L,F,s)
```

Remove any columns that are all zeros.

```{r filter-data-1}
X <- X[,colSums(X > 0) > 0]
```

*Add text here.*

```{r fit-1, results="hide", message=FALSE}
fit0 <- fit_poisson_nmf(X,k,numiter = 50,method = "em",
                        control = list(extrapolate = FALSE,numiter = 4))
```

*Add text here.*

```{r fit-2, results="hide", message=FALSE}
fit1 <- fit_poisson_nmf(X,fit0 = fit0,numiter = 1000,method = "em",
                        control = list(extrapolate = FALSE,numiter = 4))
```

*Add text here.*

```{r fit-3, results="hide", message=FALSE}
fit2 <- fit_poisson_nmf(X,fit0 = fit0,numiter = 1000,method = "scd",
                        control = list(extrapolate = FALSE,numiter = 4))
```

```{r fit-4, results="hide", message=FALSE}
fit3 <- fit_poisson_nmf(X,fit0 = fit1,numiter = 50,method = "scd",
                        control = list(extrapolate = FALSE,numiter = 4))
```

*Add text here.*

```{r plot-1, fig.width=4, fig.height=3}
fit1 <- poisson2multinom(fit1)
fit2 <- poisson2multinom(fit2)
fit3 <- poisson2multinom(fit3)
plot_progress(list(em = fit1,scd = fit2,"em+scd" = fit3),
              x = "iter",add.point.every = 100)
```

Correlated topics scenario
--------------------------

*Add text here.*

```{r simulate-data-2}
```
